(()=>{"use strict";var e,t={554:(e,t,s)=>{class i{constructor(){if(i.instance)return i.instance;this.elements={},this.state={isDragging:!1,isProcessing:!1,isMobile:window.innerWidth<=768,darkMode:"dark"===this.detectSystemTheme(),currentTheme:this.detectSystemTheme()},this.animationFrame=null,this.init(),i.instance=this}init(){this.cacheElements(),this.bindEvents(),this.setupObservers(),this.applyTheme(),this.handleResize()}cacheElements(){this.elements.dropArea=document.getElementById("dropArea"),this.elements.fileInput=document.getElementById("fileInput"),this.elements.browseBtn=document.getElementById("browseBtn"),this.elements.fileInfoPanel=document.getElementById("fileInfoPanel"),this.elements.fileName=document.getElementById("fileName"),this.elements.fileSize=document.getElementById("fileSize"),this.elements.pageCount=document.getElementById("pageCount"),this.elements.imageCount=document.getElementById("imageCount"),this.elements.tabs=document.querySelectorAll(".tab"),this.elements.tabPanes=document.querySelectorAll(".tab-pane"),this.elements.imageCompressionToggle=document.getElementById("imageCompressionToggle"),this.elements.qualitySlider=document.getElementById("qualitySlider"),this.elements.qualityValue=document.getElementById("qualityValue"),this.elements.removeImagesToggle=document.getElementById("removeImagesToggle"),this.elements.splitToggle=document.getElementById("splitToggle"),this.elements.splitByPages=document.getElementById("splitByPages"),this.elements.splitBySize=document.getElementById("splitBySize"),this.elements.pageRange=document.getElementById("pageRange"),this.elements.fileSizeLimit=document.getElementById("fileSizeLimit"),this.elements.pagesInput=document.getElementById("pagesInput"),this.elements.sizeInput=document.getElementById("sizeInput"),this.elements.resetBtn=document.getElementById("resetBtn"),this.elements.processBtn=document.getElementById("processBtn"),this.elements.progressSection=document.getElementById("progressSection"),this.elements.progressFill=document.getElementById("progressFill"),this.elements.progressText=document.getElementById("progressText"),this.elements.resultsSection=document.getElementById("resultsSection"),this.elements.originalSize=document.getElementById("originalSize"),this.elements.compressedSize=document.getElementById("compressedSize"),this.elements.savings=document.getElementById("savings"),this.elements.originalDownload=document.getElementById("originalDownload"),this.elements.compressedDownload=document.getElementById("compressedDownload"),this.elements.installBanner=document.getElementById("installBanner"),this.elements.offlineNotification=document.getElementById("offlineNotification"),this.elements.installBtn=document.getElementById("installBtn"),this.elements.closeInstallBanner=document.getElementById("closeInstallBanner"),this.elements.mobileMenuToggle=document.getElementById("mobileMenuToggle"),this.elements.mobileMenu=document.getElementById("mobileMenu")}bindEvents(){this.elements.browseBtn&&this.elements.browseBtn.addEventListener("click",()=>{this.elements.fileInput&&this.elements.fileInput.click()}),this.elements.fileInput&&this.elements.fileInput.addEventListener("change",e=>{this.handleFileSelect(e)}),this.elements.dropArea&&(this.elements.dropArea.addEventListener("dragover",e=>{e.preventDefault(),this.updateUploadArea(!0)}),this.elements.dropArea.addEventListener("dragleave",()=>{this.updateUploadArea(!1)}),this.elements.dropArea.addEventListener("drop",e=>{e.preventDefault(),this.updateUploadArea(!1),this.handleDrop(e)})),this.setupTabs(),this.setupOptionControls(),this.elements.resetBtn&&this.elements.resetBtn.addEventListener("click",()=>{this.resetApp()}),this.elements.processBtn&&this.elements.processBtn.addEventListener("click",()=>{this.handleProcess()}),this.elements.installBtn&&this.elements.installBtn.addEventListener("click",()=>{this.handleInstall()}),this.elements.closeInstallBanner&&this.elements.closeInstallBanner.addEventListener("click",()=>{this.hideInstallPrompt()}),this.elements.mobileMenuToggle&&this.elements.mobileMenuToggle.addEventListener("click",()=>{this.toggleMobileMenu()}),document.addEventListener("keydown",e=>{this.handleKeyboardNavigation(e)})}setupObservers(){if(window.addEventListener("resize",this.debounce(()=>{this.handleResize()},250)),"IntersectionObserver"in window){const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("visible")})},{threshold:.1});document.querySelectorAll(".upload-container, .options-section, .results-section").forEach(t=>e.observe(t))}}updateUploadArea(e){this.elements.dropArea&&(this.state.isDragging=e,e?(this.elements.dropArea.classList.add("drag-over"),this.triggerAnimation("upload-drag-over")):(this.elements.dropArea.classList.remove("drag-over"),this.triggerAnimation("upload-drag-leave")))}showFileInfo(e){this.elements.fileInfoPanel&&(this.elements.fileName&&(this.elements.fileName.textContent=e.fileName||"Unknown"),this.elements.fileSize&&(this.elements.fileSize.textContent=this.formatFileSize(e.fileSize||0)),this.elements.pageCount&&(this.elements.pageCount.textContent=e.pageCount||"Calculating..."),this.elements.imageCount&&(this.elements.imageCount.textContent=e.imageCount||"Analyzing..."),this.elements.fileInfoPanel.style.display="block",this.triggerAnimation("file-info-show"))}resetUploadArea(){this.elements.fileInfoPanel&&(this.elements.fileInfoPanel.style.display="none"),this.elements.fileInput&&(this.elements.fileInput.value=""),this.elements.dropArea&&(this.elements.dropArea.style.display="block"),this.triggerAnimation("upload-reset")}handleFileSelect(e){if(e.target.files&&e.target.files.length>0){const t=e.target.files[0];this.processSelectedFile(t)}}handleDrop(e){if(e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];this.processSelectedFile(t)}}processSelectedFile(e){this.showFileInfo({fileName:e.name,fileSize:e.size,pageCount:Math.floor(100*Math.random())+1,imageCount:Math.floor(20*Math.random())+1})}setupTabs(){this.elements.tabs&&this.elements.tabPanes&&this.elements.tabs.forEach(e=>{e.addEventListener("click",()=>{this.switchTab(e)})})}switchTab(e){this.elements.tabs.forEach(e=>e.classList.remove("active")),this.elements.tabPanes.forEach(e=>e.classList.remove("active")),e.classList.add("active");const t=e.getAttribute("data-tab"),s=document.getElementById(`${t}Tab`);s&&s.classList.add("active"),this.triggerAnimation("tab-switch")}setupOptionControls(){this.elements.imageCompressionToggle&&this.elements.imageCompressionToggle.addEventListener("change",e=>{this.toggleOption("imageCompression",e.target.checked)}),this.elements.qualitySlider&&this.elements.qualityValue&&this.elements.qualitySlider.addEventListener("input",e=>{this.updateQualitySlider(e.target.value)}),this.elements.removeImagesToggle&&this.elements.removeImagesToggle.addEventListener("change",e=>{this.toggleOption("removeImages",e.target.checked)}),this.elements.splitToggle&&this.elements.splitToggle.addEventListener("change",e=>{this.toggleOption("splitPDF",e.target.checked),this.toggleSplitControls(e.target.checked)}),this.elements.splitByPages&&this.elements.splitBySize&&(this.elements.splitByPages.addEventListener("change",()=>{this.updateSplitControls("pages")}),this.elements.splitBySize.addEventListener("change",()=>{this.updateSplitControls("size")})),this.elements.pageRange&&this.elements.pageRange.addEventListener("input",()=>{this.validateInputs()}),this.elements.fileSizeLimit&&this.elements.fileSizeLimit.addEventListener("input",()=>{this.validateInputs()})}toggleOption(e,t){this.triggerAnimation(`option-${e}-toggle`)}updateQualitySlider(e){this.elements.qualityValue&&(this.elements.qualityValue.textContent=e),this.triggerAnimation("quality-slider-update")}updateSplitControls(e){this.elements.pagesInput&&this.elements.sizeInput&&("pages"===e?(this.elements.pagesInput.style.display="block",this.elements.sizeInput.style.display="none"):(this.elements.pagesInput.style.display="none",this.elements.sizeInput.style.display="block"),this.triggerAnimation("split-controls-update"))}toggleSplitControls(e){const t=document.querySelector(".split-options");t&&(t.style.display=e?"block":"none")}validateInputs(){let e=!0;if(this.elements.pageRange&&null!==this.elements.pageRange.offsetParent){const t=this.elements.pageRange.value;t&&!/^\d+-\d+$/.test(t)?(e=!1,this.elements.pageRange.classList.add("invalid")):this.elements.pageRange.classList.remove("invalid")}if(this.elements.fileSizeLimit&&null!==this.elements.fileSizeLimit.offsetParent){const t=parseInt(this.elements.fileSizeLimit.value);isNaN(t)||t<1||t>500?(e=!1,this.elements.fileSizeLimit.classList.add("invalid")):this.elements.fileSizeLimit.classList.remove("invalid")}return e}showProgress(){this.elements.progressSection&&(this.elements.progressSection.style.display="block"),this.elements.fileInfoPanel&&(this.elements.fileInfoPanel.style.display="none"),this.state.isProcessing=!0,this.triggerAnimation("progress-show")}updateProgress(e,t){this.elements.progressFill&&(this.elements.progressFill.style.width=`${e}%`),this.elements.progressText&&(this.elements.progressText.textContent=t||`Processing... ${e}%`),this.triggerAnimation("progress-update")}hideProgress(){this.elements.progressSection&&(this.elements.progressSection.style.display="none"),this.state.isProcessing=!1,this.triggerAnimation("progress-hide")}showResults(e){this.elements.resultsSection&&(this.hideProgress(),this.elements.resultsSection.style.display="block",e.originalFile&&this.elements.originalSize&&(this.elements.originalSize.textContent=this.formatFileSize(e.originalFile.size)),e.processedFile&&this.elements.compressedSize&&(this.elements.compressedSize.textContent=this.formatFileSize(e.processedFile.size)),e.savings&&this.elements.savings&&(this.elements.savings.textContent=this.formatFileSize(e.savings.savingsBytes)+` (${e.savings.savingsPercentage}% reduction)`),this.elements.originalDownload&&this.elements.originalDownload.addEventListener("click",t=>{t.preventDefault(),this.handleDownload(e.originalFile)}),this.elements.compressedDownload&&this.elements.compressedDownload.addEventListener("click",t=>{t.preventDefault(),this.handleDownload(e.processedFile)}),this.triggerAnimation("results-show"))}createResultCard(e){const t=document.createElement("div");return t.className="result-card",t.innerHTML=`\n      <div class="result-card-header">\n        <h4>${e.name}</h4>\n        <span class="file-size">${this.formatFileSize(e.size)}</span>\n      </div>\n      <div class="result-card-actions">\n        <button class="download-btn" data-file-id="${e.id}">Download</button>\n      </div>\n    `,t}handleDownload(e){if(!e)return;const t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=e.name,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),URL.revokeObjectURL(t)},100),this.triggerAnimation("file-download")}clearResults(){this.elements.resultsSection&&(this.elements.resultsSection.style.display="none"),this.triggerAnimation("results-clear")}showNotification(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const s=document.createElement("div");s.className=`notification notification-${t}`,s.textContent=e;const i=document.createElement("button");i.innerHTML="&times;",i.className="notification-close",i.addEventListener("click",()=>{s.remove()}),s.appendChild(i),document.body.appendChild(s),setTimeout(()=>{s.parentNode&&s.remove()},5e3),this.triggerAnimation("notification-show")}showOfflineMode(){this.elements.offlineNotification&&(this.elements.offlineNotification.style.display="block",this.elements.offlineNotification.classList.add("visible")),this.triggerAnimation("offline-show")}hideOfflineMode(){this.elements.offlineNotification&&(this.elements.offlineNotification.style.display="none",this.elements.offlineNotification.classList.remove("visible")),this.triggerAnimation("offline-hide")}showUpdateAvailable(){this.showNotification("A new version is available. Please refresh to update.","info"),this.triggerAnimation("update-show")}showInstallPrompt(){this.elements.installBanner&&(this.elements.installBanner.style.display="flex",this.elements.installBanner.classList.add("visible")),this.triggerAnimation("install-show")}hideInstallPrompt(){this.elements.installBanner&&(this.elements.installBanner.style.display="none",this.elements.installBanner.classList.remove("visible")),this.triggerAnimation("install-hide")}handleInstall(){this.hideInstallPrompt(),this.triggerAnimation("install-handle")}handleResize(){this.state.isMobile=window.innerWidth<=768,this.adaptLayout(),this.triggerAnimation("resize")}toggleMobileMenu(){if(this.elements.mobileMenu){this.elements.mobileMenu.classList.contains("open")?this.elements.mobileMenu.classList.remove("open"):this.elements.mobileMenu.classList.add("open")}this.triggerAnimation("mobile-menu-toggle")}adaptLayout(){const e=document.querySelector(".upload-container");e&&(this.state.isMobile?e.classList.add("mobile-layout"):e.classList.remove("mobile-layout")),this.triggerAnimation("layout-adapt")}handleKeyboardNavigation(e){"Escape"===e.key&&(this.hideInstallPrompt(),this.triggerAnimation("escape-key")),"Tab"===e.key&&this.manageFocus(e)}manageFocus(e){}updateAria(e,t,s){e&&e.setAttribute(t,s)}announceToScreenReader(e){let t=document.getElementById("screen-reader-announcements");t||(t=document.createElement("div"),t.id="screen-reader-announcements",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.position="absolute",t.style.left="-10000px",document.body.appendChild(t)),t.textContent=e}triggerAnimation(e){this.animationFrame&&cancelAnimationFrame(this.animationFrame),this.animationFrame=requestAnimationFrame(()=>{})}debounce(e,t){let s;return function(){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),e(...n)},t)}}toggleDarkMode(){this.state.darkMode=!this.state.darkMode,this.applyTheme(),this.savePreference(),this.triggerAnimation("theme-toggle")}applyTheme(){this.state.darkMode?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode")}savePreference(){try{localStorage.setItem("pdf-compressor-theme",this.state.darkMode?"dark":"light")}catch(e){}}detectSystemTheme(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}handleProcess(){this.showProgress();let e=0;const t=setInterval(()=>{e+=5,this.updateProgress(e,`Processing... ${e}%`),e>=100&&(clearInterval(t),this.showResults({originalFile:{size:1e6,name:"original.pdf"},processedFile:{size:7e5,name:"compressed.pdf"},savings:{savingsBytes:3e5,savingsPercentage:"30.00"}}))},100)}resetApp(){this.resetUploadArea(),this.hideProgress(),this.clearResults(),this.triggerAnimation("app-reset")}}const n=new i;var a=s(987);class r{constructor(){this.worker=null,this.isWorkerSupported="undefined"!=typeof Worker,this.taskCounter=0}async initWorker(){if(!this.isWorkerSupported)throw new Error("Web Workers not supported in this environment");if(this.worker)return this.worker;try{const e=new Blob([`importScripts('${window.location.origin}/src/js/pdf-worker.js');`],{type:"application/javascript"}),t=URL.createObjectURL(e);return this.worker=new Worker(t),this.setupWorkerMessaging(),await new Promise((e,t)=>{const s=setTimeout(()=>{t(new Error("Worker initialization timeout"))},5e3),i=t=>{"WORKER_READY"===t.data.type&&(clearTimeout(s),this.worker.removeEventListener("message",i),e(this.worker))};this.worker.addEventListener("message",i)}),URL.revokeObjectURL(t),this.worker}catch(e){throw this.worker=null,new Error(`Failed to initialize worker: ${e.message}`)}}setupWorkerMessaging(){this.worker&&(this.worker.onmessage=e=>{const{type:t,taskId:s,result:i,error:n,percentage:a,message:r,performance:o}=e.data;switch(t){case"PROGRESS_UPDATE":case"TASK_QUEUED":case"PROCESSING_STARTED":case"TASK_CANCELLED":case"TASK_NOT_FOUND":case"STATUS_UPDATE":case"WORKER_READY":case"WORKER_CLEANUP_COMPLETED":break;case"PROCESSING_COMPLETED":if(this.pendingTasks&&this.pendingTasks[s]){const{resolve:e}=this.pendingTasks[s];delete this.pendingTasks[s],e({result:i,performance:o})}break;case"ERROR":if(this.pendingTasks&&this.pendingTasks[s]){const{reject:e}=this.pendingTasks[s];delete this.pendingTasks[s],e(new Error(n))}}},this.worker.onerror=e=>{},this.pendingTasks={})}generateTaskId(){return`task-${Date.now()}-${++this.taskCounter}`}async loadPDF(e){try{if(!this.validatePDF(e))throw new Error("Invalid PDF file");const t=await e.arrayBuffer(),s=await a.PDFDocument.load(t,{updateMetadata:!1,parseSpeed:"fast"});return{pdfDoc:s,metadata:this.extractMetadata(s,e),arrayBuffer:t}}catch(e){throw new Error(`Failed to load PDF: ${e.message}`)}}async compressImages(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{if(this.isWorkerSupported)try{return await this.initWorker(),await this.compressImagesWithWorker(e,t,s)}catch(e){}const i=e.getPages(),n=i.length;for(let e=0;e<i.length;e++){i[e];s&&s({page:e+1,total:n,percentage:Math.round((e+1)/n*100)}),await new Promise(e=>setTimeout(e,100))}return e}catch(e){throw new Error(`Failed to compress images: ${e.message}`)}}async compressImagesWithWorker(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=this.generateTaskId(),n=await e.save(),r=new Promise((e,t)=>{if(this.pendingTasks||(this.pendingTasks={}),this.pendingTasks[i]={resolve:e,reject:t},s){const e=e=>{"PROGRESS_UPDATE"===e.data.type&&e.data.taskId===i&&s({percentage:e.data.percentage,message:e.data.message})};this.worker.addEventListener("message",e);const t=s=>{"PROCESSING_COMPLETED"!==s.data.type&&"ERROR"!==s.data.type||s.data.taskId!==i||(this.worker.removeEventListener("message",e),this.worker.removeEventListener("message",t))};this.worker.addEventListener("message",t)}});this.worker.postMessage({type:"PROCESS_COMPRESS_IMAGES",taskId:i,payload:{pdfBytes:n,quality:t,taskId:i}});const{result:o}=await r;return await a.PDFDocument.load(o.pdfBytes)}async removeImages(e){try{if(this.isWorkerSupported)try{return await this.initWorker(),await this.removeImagesWithWorker(e)}catch(e){}const t=e.getPages();for(let e=0;e<t.length;e++){t[e];await new Promise(e=>setTimeout(e,50))}return e}catch(e){throw new Error(`Failed to remove images: ${e.message}`)}}async removeImagesWithWorker(e){const t=this.generateTaskId(),s=await e.save(),i=new Promise((e,s)=>{this.pendingTasks||(this.pendingTasks={}),this.pendingTasks[t]={resolve:e,reject:s}});this.worker.postMessage({type:"PROCESS_REMOVE_IMAGES",taskId:t,payload:{pdfBytes:s,taskId:t}});const{result:n}=await i;return await a.PDFDocument.load(n.pdfBytes)}async splitByPages(e,t,s){try{if(this.isWorkerSupported)try{return await this.initWorker(),await this.splitByPagesWithWorker(e,t,s)}catch(e){}const i=e.getPageCount();if(t<1||s>i||t>s)throw new Error(`Invalid page range. PDF has ${i} pages.`);const n=await a.PDFDocument.create();for(let i=t;i<=s;i++){const[t]=await n.copyPages(e,[i-1]);n.addPage(t)}return n}catch(e){throw new Error(`Failed to split PDF by pages: ${e.message}`)}}async splitByPagesWithWorker(e,t,s){const i=this.generateTaskId(),n=await e.save(),r=new Promise((e,t)=>{this.pendingTasks||(this.pendingTasks={}),this.pendingTasks[i]={resolve:e,reject:t}});this.worker.postMessage({type:"PROCESS_SPLIT_PDF",taskId:i,payload:{pdfBytes:n,startPage:t,endPage:s,taskId:i}});const{result:o}=await r;return await a.PDFDocument.load(o.pdfBytes)}async splitBySize(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{const i=1024*t*1024,n=[],a=e.getPageCount();let r=1,o=a;for(;r<=a;){let t=await this.estimateOptimalChunkEnd(e,r,o,i);const l=await this.splitByPages(e,r,t);if(n.push(l),s&&s({chunk:n.length,totalChunks:"calculating",percentage:Math.round(t/a*100)}),r=t+1,r>a)break}return n}catch(e){throw new Error(`Failed to split PDF by size: ${e.message}`)}}async estimateOptimalChunkEnd(e,t,s,i){let n=t,a=s,r=t;for(;n<=a;){const e=Math.floor((n+a)/2);1e5*(e-t+1)<=i?(r=e,n=e+1):a=e-1}return r}async optimizePDF(e){try{if(this.isWorkerSupported)try{return await this.initWorker(),await this.optimizePDFWithWorker(e)}catch(e){}return await new Promise(e=>setTimeout(e,500)),e}catch(e){throw new Error(`Failed to optimize PDF: ${e.message}`)}}async optimizePDFWithWorker(e){const t=this.generateTaskId(),s=await e.save(),i=new Promise((e,s)=>{this.pendingTasks||(this.pendingTasks={}),this.pendingTasks[t]={resolve:e,reject:s}});this.worker.postMessage({type:"PROCESS_OPTIMIZE_PDF",taskId:t,payload:{pdfBytes:s,taskId:t}});const{result:n}=await i;return await a.PDFDocument.load(n.pdfBytes)}async processPDF(e,t){try{const{pdfDoc:s,metadata:i}=await this.loadPDF(e);let n=s;if(t.imageCompression&&(n=await this.compressImages(n,t.imageQuality)),t.removeImages&&(n=await this.removeImages(n)),t.splitPDF)if("pages"===t.splitMethod&&t.pageRange){const[e,s]=t.pageRange.split("-").map(Number);n=await this.splitByPages(n,e,s)}else if("size"===t.splitMethod){n=(await this.splitBySize(n,t.fileSizeLimit))[0]}n=await this.optimizePDF(n);const a=await n.save(),r=this.generateFileName(e.name,t),o=new File([a],r,{type:"application/pdf"});return{originalFile:e,processedFile:o,metadata:i,savings:this.estimateCompression(e.size,o.size),processingTime:Date.now()}}catch(e){throw new Error(`Failed to process PDF: ${e.message}`)}}validatePDF(e){return!("application/pdf"!==e.type&&!e.name.toLowerCase().endsWith(".pdf"))&&0!==e.size}extractMetadata(e,t){try{const s=e.getTitle()||t.name.replace(".pdf",""),i=e.getAuthor()||"Unknown",n=e.getSubject()||"",a=e.getKeywords()||"",r=e.getCreator()||"",o=e.getProducer()||"",l=e.getCreationDate(),c=e.getModificationDate(),h=e.getPageCount();return{title:s,author:i,subject:n,keywords:a,creator:r,producer:o,creationDate:l||new Date,modificationDate:c||new Date,pageCount:h,fileSize:t.size}}catch(s){return{title:t.name.replace(".pdf",""),author:"Unknown",subject:"",keywords:"",creator:"",producer:"",creationDate:new Date,modificationDate:new Date,pageCount:e?e.getPageCount():0,fileSize:t.size}}}async generateThumbnail(e){try{return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg=="}catch(e){return null}}estimateCompression(e,t){const s=e-t;return{originalSize:e,compressedSize:t,savingsBytes:s,savingsPercentage:(e>0?s/e*100:0).toFixed(2)}}generateFileName(e,t){const s=e.replace(/\.[^/.]+$/,"");let i="";t.imageCompression&&(i+=`-compressed-${t.imageQuality}`),t.removeImages&&(i+="-no-images"),t.splitPDF&&(i+="-split");return`${s}${i}-${(new Date).toISOString().slice(0,19).replace(/:/g,"-")}.pdf`}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null)}}class o{constructor(){if(o.instance)return o.instance;this.dbName="PDFCompressorDB",this.dbVersion=1,this.db=null,this.cacheName="pdf-compressor-cache-v1",this.sessionPrefix="pdf-compressor-",this.storageQuota=null,this.storageUsage=null,o.instance=this}async init(){try{await this.initDB(),await this.initCache(),this.setupEventListeners()}catch(e){throw new Error(`Storage initialization failed: ${e.message}`)}}async initDB(){return new Promise((e,t)=>{if(!window.indexedDB)return void t(new Error("IndexedDB is not supported in this browser"));const s=indexedDB.open(this.dbName,this.dbVersion);s.onerror=e=>{t(e.target.error)},s.onsuccess=t=>{this.db=t.target.result,e()},s.onupgradeneeded=e=>{if(this.db=e.target.result,!this.db.objectStoreNames.contains("files")){const e=this.db.createObjectStore("files",{keyPath:"id"});e.createIndex("fileName","fileName",{unique:!1}),e.createIndex("dateAdded","dateAdded",{unique:!1})}if(!this.db.objectStoreNames.contains("results")){const e=this.db.createObjectStore("results",{keyPath:"id"});e.createIndex("originalFileId","originalFileId",{unique:!1}),e.createIndex("dateProcessed","dateProcessed",{unique:!1})}if(!this.db.objectStoreNames.contains("settings")){this.db.createObjectStore("settings",{keyPath:"key"})}}})}async initCache(){if("caches"in window)try{await caches.open(this.cacheName)}catch(e){}}setupEventListeners(){window.addEventListener("storage",this.handleStorageChange.bind(this)),setInterval(()=>{this.monitorStorageUsage()},3e5)}async saveFile(e,t){try{if(!this.db)throw new Error("Database not initialized");const s=this.db.transaction(["files"],"readwrite").objectStore("files"),i=await e.arrayBuffer(),n={id:this.generateId(),fileName:e.name,fileType:e.type,fileSize:e.size,data:i,metadata:t,dateAdded:new Date};return await this.putInStore(s,n),n.id}catch(e){throw this.handleStorageError(e,"saveFile"),e}}async getFile(e){try{if(!this.db)throw new Error("Database not initialized");const t=this.db.transaction(["files"],"readonly").objectStore("files"),s=await this.getFromStore(t,e);if(s){const e=new Blob([s.data],{type:s.fileType});return{...s,blob:e}}return s}catch(e){throw e}}async deleteFile(e){try{if(!this.db)throw new Error("Database not initialized");const t=this.db.transaction(["files"],"readwrite").objectStore("files");await this.deleteFromStore(t,e)}catch(e){throw e}}async getAllFiles(){try{if(!this.db)throw new Error("Database not initialized");const e=this.db.transaction(["files"],"readonly").objectStore("files");return(await this.getAllFromStore(e)).map(e=>({...e,blob:new Blob([e.data],{type:e.fileType})}))}catch(e){throw e}}async clearOldFiles(e){try{if(!this.db)throw new Error("Database not initialized");const t=new Date;t.setDate(t.getDate()-e);const s=this.db.transaction(["files"],"readwrite").objectStore("files"),i=(await this.getAllFromStore(s)).filter(e=>new Date(e.dateAdded)<t);let n=0;for(const e of i)await this.deleteFromStore(s,e.id),n++;return n}catch(e){throw e}}async saveResult(e){try{if(!this.db)throw new Error("Database not initialized");const t=this.db.transaction(["results"],"readwrite").objectStore("results"),s=await e.originalFile.arrayBuffer(),i=await e.processedFile.arrayBuffer(),n={id:this.generateId(),originalFile:{name:e.originalFile.name,type:e.originalFile.type,size:e.originalFile.size,data:s},processedFile:{name:e.processedFile.name,type:e.processedFile.type,size:e.processedFile.size,data:i},metadata:e.metadata,savings:e.savings,processingTime:e.processingTime,dateProcessed:new Date};return await this.putInStore(t,n),n.id}catch(e){throw this.handleStorageError(e,"saveResult"),e}}async getResult(e){try{if(!this.db)throw new Error("Database not initialized");const t=this.db.transaction(["results"],"readonly").objectStore("results"),s=await this.getFromStore(t,e);return s?{...s,originalFile:new Blob([s.originalFile.data],{type:s.originalFile.type}),processedFile:new Blob([s.processedFile.data],{type:s.processedFile.type})}:s}catch(e){throw e}}async getAllResults(){try{if(!this.db)throw new Error("Database not initialized");const e=this.db.transaction(["results"],"readonly").objectStore("results");return(await this.getAllFromStore(e)).map(e=>({...e,originalFile:new Blob([e.originalFile.data],{type:e.originalFile.type}),processedFile:new Blob([e.processedFile.data],{type:e.processedFile.type})}))}catch(e){throw e}}async deleteResult(e){try{if(!this.db)throw new Error("Database not initialized");const t=this.db.transaction(["results"],"readwrite").objectStore("results");await this.deleteFromStore(t,e)}catch(e){throw e}}async cacheProcessedPDF(e,t){try{if("caches"in window){const s=await caches.open(this.cacheName),i=new Response(e);await s.put(t,i)}}catch(e){this.handleStorageError(e,"cacheProcessedPDF")}}async getCachedPDF(e){try{if("caches"in window){const t=await caches.open(this.cacheName),s=await t.match(e);if(s)return await s.blob()}return null}catch(e){return null}}async clearCache(){try{"caches"in window&&(await caches.delete(this.cacheName),await this.initCache())}catch(e){}}async getCacheSize(){try{if("caches"in window){const e=await caches.open(this.cacheName),t=await e.keys();let s=0;for(const i of t){const t=await e.match(i);if(t){s+=(await t.blob()).size}}return s}return 0}catch(e){return 0}}async saveSettings(e){try{if(!this.db)throw new Error("Database not initialized");const t=this.db.transaction(["settings"],"readwrite").objectStore("settings"),s={key:"userSettings",value:e,lastUpdated:new Date};await this.putInStore(t,s),this.syncWithLocalStorage(e)}catch(e){throw this.handleStorageError(e,"saveSettings"),e}}async loadSettings(){try{if(!this.db)throw new Error("Database not initialized");const e=this.db.transaction(["settings"],"readonly").objectStore("settings"),t=await this.getFromStore(e,"userSettings");if(t)return t.value;const s=localStorage.getItem(`${this.sessionPrefix}settings`);return s?JSON.parse(s):{}}catch(e){return{}}}async resetSettings(){try{if(!this.db)throw new Error("Database not initialized");const e=this.db.transaction(["settings"],"readwrite").objectStore("settings");await this.deleteFromStore(e,"userSettings"),localStorage.removeItem(`${this.sessionPrefix}settings`)}catch(e){throw e}}async checkStorageQuota(){try{if("storage"in navigator&&"estimate"in navigator.storage){const e=await navigator.storage.estimate();return this.storageQuota=e.quota,this.storageUsage=e.usage,{quota:e.quota,usage:e.usage,percentage:e.usage&&e.quota?Math.round(e.usage/e.quota*100):0}}return{quota:null,usage:null,percentage:0}}catch(e){return{quota:null,usage:null,percentage:0}}}async requestPersistentStorage(){try{if("storage"in navigator&&"persist"in navigator.storage){return await navigator.storage.persist()}return!1}catch(e){return!1}}async monitorStorageUsage(){try{(await this.checkStorageQuota()).percentage}catch(e){}}saveToSession(e,t){try{const s=`${this.sessionPrefix}${e}`;return sessionStorage.setItem(s,JSON.stringify(t)),!0}catch(e){return this.handleStorageError(e,"saveToSession"),!1}}getFromSession(e){try{const t=`${this.sessionPrefix}${e}`,s=sessionStorage.getItem(t);return s?JSON.parse(s):null}catch(e){return null}}clearSession(){try{Object.keys(sessionStorage).forEach(e=>{e.startsWith(this.sessionPrefix)&&sessionStorage.removeItem(e)})}catch(e){}}async exportData(){try{if(!this.db)throw new Error("Database not initialized");const e=await this.getAllFiles(),t=await this.loadSettings(),s={};Object.keys(sessionStorage).forEach(e=>{if(e.startsWith(this.sessionPrefix)){const t=e.replace(this.sessionPrefix,"");s[t]=this.getFromSession(t)}});const i={files:e.map(e=>({...e,data:this.arrayBufferToBase64(e.data)})),settings:t,sessionData:s,exportDate:(new Date).toISOString()},n=JSON.stringify(i,null,2);return new Blob([n],{type:"application/json"})}catch(e){throw e}}async importData(e){try{if(!this.db)throw new Error("Database not initialized");const t=await e.text(),s=JSON.parse(t);if(s.files&&Array.isArray(s.files)){const e=this.db.transaction(["files"],"readwrite").objectStore("files");for(const t of s.files)t.data=this.base64ToArrayBuffer(t.data),await this.putInStore(e,t)}s.settings&&await this.saveSettings(s.settings),s.sessionData&&Object.keys(s.sessionData).forEach(e=>{this.saveToSession(e,s.sessionData[e])})}catch(e){throw e}}syncWithLocalStorage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{e?localStorage.setItem(`${this.sessionPrefix}settings`,JSON.stringify(e)):this.loadSettings().then(e=>{Object.keys(e).length>0&&localStorage.setItem(`${this.sessionPrefix}settings`,JSON.stringify(e))})}catch(e){}}handleStorageChange(e){e.key&&e.key.startsWith(this.sessionPrefix)}async cleanup(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;try{await this.clearOldFiles(e),await this.monitorStorageUsage()}catch(e){}}async garbageCollect(){try{this.db&&(this.db.close(),this.db=null),await this.initDB()}catch(e){}}handleStorageError(e,t){e.name,this.useMemoryStorageFallback()}useMemoryStorageFallback(){}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}putInStore(e,t){return new Promise((s,i)=>{const n=e.put(t);n.onsuccess=()=>s(),n.onerror=e=>i(e.target.error)})}getFromStore(e,t){return new Promise((s,i)=>{const n=e.get(t);n.onsuccess=e=>s(e.target.result||null),n.onerror=e=>i(e.target.error)})}deleteFromStore(e,t){return new Promise((s,i)=>{const n=e.delete(t);n.onsuccess=()=>s(),n.onerror=e=>i(e.target.error)})}getAllFromStore(e){return new Promise((t,s)=>{const i=e.getAll();i.onsuccess=e=>t(e.target.result||[]),i.onerror=e=>s(e.target.error)})}arrayBufferToBase64(e){let t="";const s=new Uint8Array(e);for(let e=0;e<s.byteLength;e++)t+=String.fromCharCode(s[e]);return btoa(t)}base64ToArrayBuffer(e){const t=atob(e),s=new Uint8Array(t.length);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);return s.buffer}}new o;const l=new o;class c{constructor(){this.pdfProcessor=null,this.storageManager=null,this.uiController=null,this.state={currentFile:null,pdfDocument:null,processingOptions:{imageCompression:!0,imageQuality:70,removeImages:!1,splitPDF:!1,splitMethod:"pages",pageRange:"",fileSizeLimit:10},processingQueue:[],isOnline:navigator.onLine,isProcessing:!1,isVisible:!0},this.performance={startTime:null,endTime:null,memoryUsage:null},this.deferredPrompt=null,this.serviceWorkerRegistration=null,this.initializeApp()}async initializeApp(){try{if(!this.checkAPISupport())throw new Error("Required APIs not supported in this browser");await this.loadLibraries(),this.pdfProcessor=new r,this.storageManager=l,await this.storageManager.init(),this.uiController=new n,this.setupEventListeners(),await this.registerServiceWorker(),this.setupPWAFeatures(),this.handleShareTarget(),this.handleFileHandler()}catch(e){this.showErrorMessage("Failed to initialize application: "+e.message)}}checkAPISupport(){const e=["File","Blob","ArrayBuffer","Worker","indexedDB","caches"];for(const t of e)if(!(t in window))return!1;return!(!window.FileReader||!window.FileList)&&!(!window.Blob||!Blob.prototype.arrayBuffer)}async loadLibraries(){}async registerServiceWorker(){if("serviceWorker"in navigator)try{this.serviceWorkerRegistration=await navigator.serviceWorker.register("./service-worker.js"),this.serviceWorkerRegistration.addEventListener("updatefound",()=>{this.showUpdateNotification()})}catch(e){}}setupEventListeners(){document.addEventListener("DOMContentLoaded",()=>{}),window.addEventListener("online",()=>{this.state.isOnline=!0,this.updateOnlineStatus()}),window.addEventListener("offline",()=>{this.state.isOnline=!1,this.updateOnlineStatus()}),window.addEventListener("resize",this.debounce(()=>{},250)),document.addEventListener("visibilitychange",()=>{this.state.isVisible=!document.hidden,this.state.isProcessing&&this.state.isVisible})}setupPWAFeatures(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),this.deferredPrompt=e,this.uiController.showInstallPrompt()}),window.addEventListener("appinstalled",()=>{this.uiController.hideInstallPrompt()})}handleShareTarget(){new URLSearchParams(window.location.search).get("action")}handleFileHandler(){new URLSearchParams(window.location.search).get("action")}showInstallPrompt(){this.uiController.showInstallPrompt()}hideInstallPrompt(){this.uiController.hideInstallPrompt()}showUpdateNotification(){this.uiController.showUpdateAvailable()}updateOnlineStatus(){this.state.isOnline?this.uiController.hideOfflineMode():this.uiController.showOfflineMode()}async handleFileSelection(e){try{if(!this.validateFile(e))return;this.state.currentFile=e;const t=await this.pdfProcessor.loadPDF(e);this.state.pdfDocument=t.pdfDoc,this.uiController.showFileInfo(t.metadata)}catch(e){this.showErrorMessage("Error loading file: "+e.message)}}validateFile(e){if("application/pdf"!==e.type&&!e.name.toLowerCase().endsWith(".pdf"))return this.showErrorMessage("Please select a valid PDF file"),!1;return!(e.size>524288e3)||(this.showErrorMessage(`File size exceeds 500MB limit. Selected file: ${this.formatFileSize(e.size)}`),!1)}async processPDF(){if(this.state.currentFile&&this.state.pdfDocument)try{this.state.isProcessing=!0,this.startPerformanceTracking();const e=await this.pdfProcessor.processPDF(this.state.currentFile,this.state.processingOptions);this.endPerformanceTracking(),await this.storageManager.saveResult(e),this.uiController.showResults(e),this.state.isProcessing=!1}catch(e){this.state.isProcessing=!1,this.showErrorMessage("Error processing PDF: "+e.message)}else this.showErrorMessage("No PDF file selected")}startPerformanceTracking(){this.performance.startTime=performance.now(),performance.mark("processing-start")}endPerformanceTracking(){this.performance.endTime=performance.now(),performance.mark("processing-end"),performance.measure("processing-duration","processing-start","processing-end");this.performance.endTime,this.performance.startTime}showProcessingResults(e){this.uiController.showResults(e)}showErrorMessage(e){this.uiController.showNotification(e,"error")}formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}generateFileName(e,t){const s=e.replace(/\.[^/.]+$/,"");let i="";t.imageCompression&&(i+=`-compressed-${t.imageQuality}`),t.removeImages&&(i+="-no-images"),t.splitPDF&&(i+="-split");return`${s}${i}-${(new Date).toISOString().slice(0,19).replace(/:/g,"-")}.pdf`}debounce(e,t){let s;return function(){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),e(...n)},t)}}throttle(e,t){let s;return function(){if(!s){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];e.apply(this,n),s=!0,setTimeout(()=>s=!1,t)}}}updateProcessingOptions(e){this.state.processingOptions={...this.state.processingOptions,...e}}addToQueue(e){this.state.processingQueue.push(e)}async processNextInQueue(){if(this.state.processingQueue.length>0){this.state.processingQueue.shift()}}}document.addEventListener("DOMContentLoaded",()=>{window.pdfCompressorApp=new c})}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var a=s[e]={exports:{}};return t[e](a,a.exports,i),a.exports}i.m=t,e=[],i.O=(t,s,n,a)=>{if(!s){var r=1/0;for(h=0;h<e.length;h++){for(var[s,n,a]=e[h],o=!0,l=0;l<s.length;l++)(!1&a||r>=a)&&Object.keys(i.O).every(e=>i.O[e](s[l]))?s.splice(l--,1):(o=!1,a<r&&(r=a));if(o){e.splice(h--,1);var c=n();void 0!==c&&(t=c)}}return t}a=a||0;for(var h=e.length;h>0&&e[h-1][2]>a;h--)e[h]=e[h-1];e[h]=[s,n,a]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={524:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var n,a,[r,o,l]=s,c=0;if(r.some(t=>0!==e[t])){for(n in o)i.o(o,n)&&(i.m[n]=o[n]);if(l)var h=l(i)}for(t&&t(s);c<r.length;c++)a=r[c],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(h)},s=self.webpackChunkpdf_compressor_pwa=self.webpackChunkpdf_compressor_pwa||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.nc=void 0;var n=i.O(void 0,[96],()=>i(554));n=i.O(n)})();